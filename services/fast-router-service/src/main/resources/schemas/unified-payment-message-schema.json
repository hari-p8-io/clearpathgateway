{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://anz.com/schemas/unified-payment-message/v3.0.0",
  "title": "Unified Payment Message Schema - Ultra Lean Version",
  "description": "Flattened JSON schema for all ISO 20022 PACS and CAMT payment messages with minimal nesting",
  "type": "object",
  "required": ["messageType", "messageId", "creationDateTime"],
  "properties": {
    "messageType": {
      "type": "string",
      "enum": ["PACS_008", "PACS_003", "PACS_007", "CAMT_056", "PACS_002", "CAMT_029"],
      "description": "Type of ISO 20022 message"
    },
    "messageVersion": {
      "type": "string",
      "description": "Version of the message schema",
      "pattern": "^\\d{2}$"
    },
    
    "_comment": "=== FLATTENED GROUP HEADER FIELDS ===",
    "messageId": {
      "type": "string",
      "maxLength": 35,
      "description": "Unique identification for the message"
    },
    "creationDateTime": {
      "type": "string",
      "format": "date-time",
      "description": "Date and time at which the message was created"
    },
    "numberOfTransactions": {
      "type": "string",
      "pattern": "^[0-9]{1,15}$",
      "description": "Number of individual transactions contained in the message"
    },
    "controlSum": {
      "type": "number",
      "description": "Total of all individual amounts included in the message"
    },
    "batchBooking": {
      "type": "boolean",
      "description": "Identifies whether the financial institution is to book the transaction on a batch or individual basis"
    },
    "settlementMethod": {
      "type": "string",
      "enum": ["INDA", "INGA", "COVE", "CLRG"],
      "description": "Method used to settle the payment"
    },
    "interbankSettlementDate": {
      "type": "string",
      "format": "date",
      "description": "Date on which the amount of money ceases to be available"
    },
    "instructingAgentBIC": {
      "type": "string",
      "pattern": "^[A-Z0-9]{4}[A-Z]{2}[A-Z0-9]{2}([A-Z0-9]{3})?$",
      "description": "Instructing agent BIC"
    },
    "instructedAgentBIC": {
      "type": "string", 
      "pattern": "^[A-Z0-9]{4}[A-Z]{2}[A-Z0-9]{2}([A-Z0-9]{3})?$",
      "description": "Instructed agent BIC"
    },
    
    "_comment2": "=== FLATTENED TRANSACTION INFORMATION ===",
    "transactions": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/LeanTransaction"
      },
      "minItems": 1,
      "description": "Array of transaction information - flattened structure"
    },
    
    "_comment3": "=== CANCELLATION/REVERSAL FIELDS ===",
    "originalMessageId": {
      "type": "string",
      "maxLength": 35,
      "description": "Original message ID for cancellation/reversal"
    },
    "originalMessageType": {
      "type": "string",
      "maxLength": 35,
      "description": "Original message type for cancellation/reversal"
    },
    "originalCreationDateTime": {
      "type": "string",
      "format": "date-time",
      "description": "Original creation date time"
    },
    
    "_comment4": "=== CASE MANAGEMENT FIELDS (CAMT.029/CAMT.056) ===",
    "caseId": {
      "type": "string",
      "maxLength": 35,
      "description": "Case identification"
    },
    "caseCreator": {
      "type": "string",
      "maxLength": 35,
      "description": "Party that created the case"
    },
    "investigationStatus": {
      "type": "string",
      "enum": ["CONF", "RJCT", "MODI", "CNCL"],
      "description": "Investigation status"
    },
    "rejectionReason": {
      "type": "string",
      "maxLength": 256,
      "description": "Rejection reason if applicable"
    },
    
    "_comment5": "=== STATUS REPORTING FIELDS (PACS.002) ===",
    "statusReports": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/LeanStatusReport"
      },
      "description": "Transaction status reports - flattened structure"
    },
    
    "_comment6": "=== SUPPLEMENTARY DATA ===",
    "supplementaryData": {
      "type": "object",
      "additionalProperties": true,
      "description": "Additional data as key-value pairs"
    }
  },
  "definitions": {
    "LeanTransaction": {
      "type": "object",
      "required": ["endToEndId"],
      "properties": {
        "_comment": "=== CORE TRANSACTION IDENTIFIERS ===",
        "instructionId": {
          "type": "string",
          "maxLength": 35,
          "description": "Unique instruction identification"
        },
        "endToEndId": {
          "type": "string",
          "maxLength": 35,
          "description": "End-to-end identification"
        },
        "transactionId": {
          "type": "string",
          "maxLength": 35,
          "description": "Transaction identification"
        },
        "UETR": {
          "type": "string",
          "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}$",
          "description": "Unique end-to-end transaction reference"
        },
        "clearingSystemReference": {
          "type": "string",
          "maxLength": 35,
          "description": "Clearing system reference"
        },
        
        "_comment2": "=== AMOUNTS ===",
        "amount": {
          "type": "number",
          "minimum": 0,
          "description": "Transaction amount"
        },
        "currency": {
          "type": "string",
          "pattern": "^[A-Z]{3}$",
          "description": "Currency code (ISO 4217)"
        },
        "interbankSettlementAmount": {
          "type": "number",
          "minimum": 0,
          "description": "Interbank settlement amount"
        },
        "instructedAmount": {
          "type": "number",
          "minimum": 0,
          "description": "Instructed amount"
        },
        
        "_comment3": "=== PARTIES - SIMPLIFIED ===",
        "debtorName": {
          "type": "string",
          "maxLength": 140,
          "description": "Debtor name"
        },
        "debtorAccountId": {
          "type": "string",
          "maxLength": 70,
          "description": "Debtor account identifier"
        },
        "debtorBIC": {
          "type": "string",
          "pattern": "^[A-Z0-9]{4}[A-Z]{2}[A-Z0-9]{2}([A-Z0-9]{3})?$",
          "description": "Debtor agent BIC"
        },
        "creditorName": {
          "type": "string",
          "maxLength": 140,
          "description": "Creditor name"
        },
        "creditorAccountId": {
          "type": "string",
          "maxLength": 70,
          "description": "Creditor account identifier"
        },
        "creditorBIC": {
          "type": "string",
          "pattern": "^[A-Z0-9]{4}[A-Z]{2}[A-Z0-9]{2}([A-Z0-9]{3})?$",
          "description": "Creditor agent BIC"
        },
        
        "_comment4": "=== PAYMENT DETAILS ===",
        "chargeBearer": {
          "type": "string",
          "enum": ["DEBT", "CRED", "SHAR", "SLEV"],
          "description": "Charge bearer"
        },
        "settlementPriority": {
          "type": "string",
          "enum": ["URGT", "HIGH", "NORM"],
          "description": "Settlement priority"
        },
        "purposeCode": {
          "type": "string",
          "maxLength": 4,
          "description": "Purpose code"
        },
        "remittanceInformation": {
          "type": "string",
          "maxLength": 140,
          "description": "Remittance information (unstructured)"
        },
        
        "_comment5": "=== DATES ===",
        "requiredExecutionDate": {
          "type": "string",
          "format": "date",
          "description": "Required execution date"
        },
        "interbankSettlementDate": {
          "type": "string",
          "format": "date",
          "description": "Interbank settlement date"
        },
        
        "_comment6": "=== CANCELLATION/REVERSAL SPECIFIC ===",
        "cancellationId": {
          "type": "string",
          "maxLength": 35,
          "description": "Cancellation ID"
        },
        "reversalId": {
          "type": "string",
          "maxLength": 35,
          "description": "Reversal ID"
        },
        "originalInstructionId": {
          "type": "string",
          "maxLength": 35,
          "description": "Original instruction ID"
        },
        "originalEndToEndId": {
          "type": "string",
          "maxLength": 35,
          "description": "Original end-to-end ID"
        },
        "originalTransactionId": {
          "type": "string",
          "maxLength": 35,
          "description": "Original transaction ID"
        },
        "cancellationReason": {
          "type": "string",
          "maxLength": 256,
          "description": "Cancellation reason"
        },
        "reversalReason": {
          "type": "string",
          "maxLength": 256,
          "description": "Reversal reason"
        }
      }
    },
    "LeanStatusReport": {
      "type": "object",
      "properties": {
        "_comment": "=== STATUS REPORTING (PACS.002) ===",
        "statusId": {
          "type": "string",
          "maxLength": 35,
          "description": "Status identification"
        },
        "originalInstructionId": {
          "type": "string",
          "maxLength": 35,
          "description": "Original instruction ID"
        },
        "originalEndToEndId": {
          "type": "string",
          "maxLength": 35,
          "description": "Original end-to-end ID"
        },
        "originalTransactionId": {
          "type": "string",
          "maxLength": 35,
          "description": "Original transaction ID"
        },
        "transactionStatus": {
          "type": "string",
          "enum": ["ACCP", "ACSC", "ACSP", "ACTC", "ACWC", "ACWP", "CANC", "PART", "PDNG", "RCVD", "RJCT"],
          "description": "Transaction status"
        },
        "statusReason": {
          "type": "string",
          "maxLength": 256,
          "description": "Status reason"
        },
        "acceptanceDateTime": {
          "type": "string",
          "format": "date-time",
          "description": "Acceptance date and time"
        },
        "clearingSystemReference": {
          "type": "string",
          "maxLength": 35,
          "description": "Clearing system reference"
        }
      }
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "messageType": {
            "const": "PACS_008"
          }
        }
      },
      "then": {
        "required": ["messageType", "messageId", "creationDateTime", "transactions"],
        "properties": {
          "transactions": {
            "type": "array",
            "items": {
              "required": ["endToEndId", "amount", "currency", "chargeBearer", "creditorName", "debtorName", "debtorAccountId"]
            }
          }
        }
      }
    },
    {
      "if": {
        "properties": {
          "messageType": {
            "const": "PACS_003"
          }
        }
      },
      "then": {
        "required": ["messageType", "messageId", "creationDateTime", "transactions"],
        "properties": {
          "transactions": {
            "type": "array",
            "items": {
              "required": ["endToEndId", "amount", "currency", "chargeBearer", "creditorName", "creditorAccountId", "debtorName", "debtorAccountId"]
            }
          }
        }
      }
    },
    {
      "if": {
        "properties": {
          "messageType": {
            "const": "PACS_007"
          }
        }
      },
      "then": {
        "required": ["messageType", "messageId", "creationDateTime", "originalMessageId", "transactions"]
      }
    },
    {
      "if": {
        "properties": {
          "messageType": {
            "const": "CAMT_056"
          }
        }
      },
      "then": {
        "required": ["messageType", "messageId", "creationDateTime", "caseId", "transactions"]
      }
    },
    {
      "if": {
        "properties": {
          "messageType": {
            "const": "PACS_002"
          }
        }
      },
      "then": {
        "required": ["messageType", "messageId", "creationDateTime", "statusReports"],
        "properties": {
          "statusReports": {
            "type": "array",
            "minItems": 1
          }
        }
      }
    },
    {
      "if": {
        "properties": {
          "messageType": {
            "const": "CAMT_029"
          }
        }
      },
      "then": {
        "required": ["messageType", "messageId", "creationDateTime", "caseId", "investigationStatus"]
      }
    }
  ]
}